---
- hosts: baremetal-compute
  gather_facts: false
  tasks:
    - name: Create ports using 1GbE mac from idrac inspection
      debug:
        msg: TODO
    - name: Update node to use inband inspector
      debug:
        msg: TODO
    - name: Do inband inspection on 1GbE
      debug:
        msg: side effect it installs mellanox stuff?
    - name: Compare expected cable state to lldp info
      debug:
        msg: TODO
    - name: Double check firmware and hardware inventory
      debug:
        msg: TODO

    - name: Update BIOS for PXE over 50GbE and dedicated iDRAC LOM
      idrac_settings:
        address: "{{ bmc_address }}"
        username: "{{ bmc_username }}"
        password: "{{ bmc_password }}"
        bios:
          LogicalProc: "Disabled"
          SysProfile: "PerfOptimized"
          EmbNic1: "DisabledOs"
          SetBootOrderFqdd1: "NIC.Slot.4-1"
          SetBootOrderFqdd2: "HardDisk.List.1-1"
          SetBootOrderFqdd3: "InfiniBand.Slot.4-1"
          SetBootOrderFqdd4: ""
      delegate_to: localhost

    - name: Do inband inspection on 50GbE to update pxe_mac
      debug:
        msg: TODO
    - name: Move to avalilable
      debug:
        msg: Will need firmware udpate first? update target BIOS version?